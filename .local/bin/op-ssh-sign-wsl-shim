#!/usr/bin/env python3

import sys
from subprocess import run, PIPE
from os.path import exists

# Example invocation
# -Y sign -n git -f /tmp/.git_signing_key_tmpXXXXXX /tmp/.git_signing_buffer_tmpXXXXXX

def to_windows_path(path):
    return run(['wslpath', '-w', path], stdout=PIPE, check=True).stdout.decode('utf-8').rstrip('\n')

def to_linux_path(path):
    return run(['wslpath', path], stdout=PIPE, check=True).stdout.decode('utf-8').rstrip('\n')

def local_app_data_path():
    return to_linux_path(run(['cmd.exe', '/c', 'echo', '%LOCALAPPDATA%'], stdout=PIPE, check=True).stdout.decode('utf-8').rstrip('\r\n'))

args = [to_windows_path(arg) if exists(arg) else arg for arg in sys.argv[1:]]
process = run([f'{local_app_data_path()}/1Password/app/8/op-ssh-sign.exe', *args])
sys.exit(process.returncode)
